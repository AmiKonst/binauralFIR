!function t(n,e,i){function o(s,a){if(!e[s]){if(!n[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=e[s]={exports:{}};n[s][0].call(u.exports,function(t){var e=n[s][1][t];return o(e?e:t)},u,u.exports,t,n,e,i)}return e[s].exports}for(var r="function"==typeof require&&require,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,n){var e=t("kdt"),i=function(){"use strict";window.audioContext=window.audioContext||new AudioContext||new webkitAudioContext;var t={hrtfDataset:{writable:!0,value:[]},hrtfDatasetLength:{writable:!0,value:0},tree:{writable:!0,value:-1},position:{writable:!0,value:{}},nextPosition:{writable:!0,value:{}},changeWhenFinishCrossfading:{writable:!0,value:!1},intervalID:{writable:!0},crossfadeDuration:{writable:!0,value:.02},input:{writable:!0},mainConvolver:{writable:!0},secondaryConvolver:{writable:!0},init:{enumerable:!0,value:function(){return this.input=audioContext.createGain(),this.mainConvolver=Object.create({},n),this.mainConvolver.init(),this.mainConvolver.gain.value=1,this.input.connect(this.mainConvolver.input),this.secondaryConvolver=Object.create({},n),this.secondaryConvolver.init(),this.secondaryConvolver.gain.value=0,this.input.connect(this.secondaryConvolver.input),this}},connect:{enumerable:!0,value:function(t){return this.mainConvolver.connect(t),this.secondaryConvolver.connect(t),this}},disconnect:{enumerable:!0,value:function(t){return this.mainConvolver.disconnect(t),this.secondaryConvolver.disconnect(t),this}},HRTFDataset:{enumerable:!0,configurable:!0,set:function(t){this.hrtfDataset=t,this.hrtfDatasetLength=this.hrtfDataset.length;for(var n=0;n<this.hrtfDatasetLength;n++){var i=this.hrtfDataset[n],o=i.azimuth*Math.PI/180,r=i.elevation*Math.PI/180,s=this.sphericalToCartesian(o,r,i.distance);i.x=s.x,i.y=s.y,i.z=s.z}this.tree=e.createKdTree(this.hrtfDataset,this.distance,["x","y","z"])},get:function(){return this.hrtfDataset}},distance:{enumerable:!1,value:function(t,n){return Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2)+Math.pow(t.z-n.z,2)}},setPosition:{enumerable:!0,value:function(t,n,e){if(3===arguments.length||4===arguments.length){var i=this.getRealCoordinates(t,n,e);if(i.azimuth!==this.position.azimuth||i.elevation!==this.position.elevation||i.distance!==this.position.distance)return this.isCrossfading()===!0?(this.changeWhenFinishCrossfading===!0?clearInterval(this.intervalID):this.changeWhenFinishCrossfading=!0,this.nextPosition.azimuth=i.azimuth,this.nextPosition.elevation=i.elevation,this.nextPosition.distance=i.distance,this.intervalID=window.setInterval(this.setLastPosition.bind(this),.005)):(this.nextPosition.azimuth=i.azimuth,this.nextPosition.elevation=i.elevation,this.nextPosition.distance=i.distance,this.reallyStartPosition()),this}}},isCrossfading:{enumerable:!1,value:function(){return 1!==this.mainConvolver.gain.value?!0:!1}},reallyStartPosition:{enumerable:!1,value:function(){this.position.azimuth=this.nextPosition.azimuth,this.position.elevation=this.nextPosition.elevation,this.position.distance=this.nextPosition.distance,this.secondaryConvolver.buffer=this.getHRTF(this.position.azimuth,this.position.elevation,this.position.distance),this.crossfading();var t=this.mainConvolver;this.mainConvolver=this.secondaryConvolver,this.secondaryConvolver=t,this.changeWhenFinishCrossfading&&(this.changeWhenFinishCrossfading=!1,clearInterval(this.intervalID))}},setCrossfadeDuration:{enumerable:!0,value:function(t){if(t)return this.crossfadeDuration=t/1e3,this;throw"CrossfadeDuration setting error"}},getCrossfadeDuration:{enumerable:!0,value:function(){return 1e3*this.crossfadeDuration}},getPosition:{enumerable:!0,value:function(){return this.position}},crossfading:{enumerable:!1,value:function(){var t=.02;this.mainConvolver.gain.setValueAtTime(1,audioContext.currentTime+t),this.mainConvolver.gain.linearRampToValueAtTime(0,audioContext.currentTime+t+this.crossfadeDuration),this.secondaryConvolver.gain.setValueAtTime(0,audioContext.currentTime+t),this.secondaryConvolver.gain.linearRampToValueAtTime(1,audioContext.currentTime+t+this.crossfadeDuration)}},getHRTF:{enumerable:!1,value:function(t,n,e){var i=this.getNearestPoint(t,n,e);return i.buffer}},sphericalToCartesian:{enumerable:!1,value:function(t,n,e){return{x:e*Math.sin(t),y:e*Math.cos(t),z:e*Math.sin(n)}}},getRealCoordinates:{enumerable:!1,value:function(t,n,e){var i=this.getNearestPoint(t,n,e);return{azimuth:i.azimuth,elevation:i.elevation,distance:i.distance}}},getNearestPoint:{enumerable:!1,value:function(t,n,e){var i=t*Math.PI/180,o=n*Math.PI/180,r=this.sphericalToCartesian(i,o,e),s=this.tree.nearest(r,1)[0];return s[0]}},setLastPosition:{enumerable:!1,value:function(){this.isCrossfading()||this.reallyStartPosition()}}},n={convNode:{writable:!0},gainNode:{writable:!0},oscillatorNode:{writable:!0},gainOscillatorNode:{writable:!0},init:{enumerable:!0,value:function(){return this.gainNode=audioContext.createGain(),this.convNode=audioContext.createConvolver(),this.convNode.normalize=!1,this.gainNode.connect(this.convNode),this.oscillatorNode=audioContext.createOscillator(),this.gainOscillatorNode=audioContext.createGain(),this.oscillatorNode.connect(this.gainOscillatorNode),this.gainOscillatorNode.connect(this.gainNode),this.gainOscillatorNode.gain.value=0,this.oscillatorNode.start(0),this}},input:{enumerable:!0,get:function(){return this.gainNode}},gain:{enumerable:!0,get:function(){return this.gainNode.gain}},buffer:{enumerable:!0,configurable:!0,set:function(t){this.convNode.buffer=t}},connect:{enumerable:!0,value:function(t){return this.convNode.connect(t),this}},disconnect:{enumerable:!0,value:function(t){return this.convNode.disconnect(t),this}}},i=Object.create({},t);return i.init()};n.exports=i},{kdt:2}],2:[function(t,n){function e(t,n,e){this.obj=t,this.left=null,this.right=null,this.parent=e,this.dimension=n}function i(t,n,i){function r(t,n,o){var s,a,l=n%i.length;return 0===t.length?null:1===t.length?new e(t[0],l,o):(t.sort(function(t,n){return t[i[l]]-n[i[l]]}),s=Math.floor(t.length/2),a=new e(t[s],l,o),a.left=r(t.slice(0,s),n+1,a),a.right=r(t.slice(s+1),n+1,a),a)}var s=this;this.root=r(t,0,null),this.insert=function(t){function n(e,o){if(null===e)return o;var r=i[e.dimension];return t[r]<e.obj[r]?n(e.left,e):n(e.right,e)}var o,r,s=n(this.root,null);return null===s?void(this.root=new e(t,0,null)):(o=new e(t,(s.dimension+1)%i.length,s),r=i[s.dimension],void(t[r]<s.obj[r]?s.left=o:s.right=o))},this.remove=function(t){function n(e){if(null===e)return null;if(e.obj===t)return e;var o=i[e.dimension];return t[o]<e.obj[o]?n(e.left,e):n(e.right,e)}function e(t){function n(t,e){var o,r,s,a,l;return null===t?null:(o=i[e],t.dimension===e?null!==t.right?n(t.right,e):t:(r=t.obj[o],s=n(t.left,e),a=n(t.right,e),l=t,null!==s&&s.obj[o]>r&&(l=s),null!==a&&a.obj[o]>l.obj[o]&&(l=a),l))}function o(t,n){var e,r,s,a,l;return null===t?null:(e=i[n],t.dimension===n?null!==t.left?o(t.left,n):t:(r=t.obj[e],s=o(t.left,n),a=o(t.right,n),l=t,null!==s&&s.obj[e]<r&&(l=s),null!==a&&a.obj[e]<l.obj[e]&&(l=a),l))}var r,a,l;return null===t.left&&null===t.right?null===t.parent?void(s.root=null):(l=i[t.parent.dimension],void(t.obj[l]<t.parent.obj[l]?t.parent.left=null:t.parent.right=null)):(r=null!==t.left?n(t.left,t.dimension):o(t.right,t.dimension),a=r.obj,e(r),void(t.obj=a))}var o;o=n(s.root),null!==o&&e(o)},this.nearest=function(t,e,r){function a(o){function r(t,n){h.push([t,n]),h.size()>e&&h.pop()}var s,l,u,c,v=i[o.dimension],f=n(t,o.obj),d={};for(c=0;c<i.length;c+=1)d[i[c]]=c===o.dimension?t[i[c]]:o.obj[i[c]];return l=n(d,o.obj),null===o.right&&null===o.left?void((h.size()<e||f<h.peek()[1])&&r(o,f)):(s=null===o.right?o.left:null===o.left?o.right:t[v]<o.obj[v]?o.left:o.right,a(s),(h.size()<e||f<h.peek()[1])&&r(o,f),void((h.size()<e||Math.abs(l)<h.peek()[1])&&(u=s===o.left?o.right:o.left,null!==u&&a(u))))}var l,u,h;if(h=new o(function(t){return-t[1]}),r)for(l=0;e>l;l+=1)h.push([null,r]);for(a(s.root),u=[],l=0;e>l;l+=1)h.content[l][0]&&u.push([h.content[l][0].obj,h.content[l][1]]);return u},this.balanceFactor=function(){function t(n){return null===n?0:Math.max(t(n.left),t(n.right))+1}function n(t){return null===t?0:n(t.left)+n(t.right)+1}return t(s.root)/(Math.log(n(s.root))/Math.log(2))}}function o(t){this.content=[],this.scoreFunction=t}o.prototype={push:function(t){this.content.push(t),this.bubbleUp(this.content.length-1)},pop:function(){var t=this.content[0],n=this.content.pop();return this.content.length>0&&(this.content[0]=n,this.sinkDown(0)),t},peek:function(){return this.content[0]},remove:function(t){for(var n=this.content.length,e=0;n>e;e++)if(this.content[e]==t){var i=this.content.pop();return void(e!=n-1&&(this.content[e]=i,this.scoreFunction(i)<this.scoreFunction(t)?this.bubbleUp(e):this.sinkDown(e)))}throw new Error("Node not found.")},size:function(){return this.content.length},bubbleUp:function(t){for(var n=this.content[t];t>0;){var e=Math.floor((t+1)/2)-1,i=this.content[e];if(!(this.scoreFunction(n)<this.scoreFunction(i)))break;this.content[e]=n,this.content[t]=i,t=e}},sinkDown:function(t){for(var n=this.content.length,e=this.content[t],i=this.scoreFunction(e);;){var o=2*(t+1),r=o-1,s=null;if(n>r){var a=this.content[r],l=this.scoreFunction(a);i>l&&(s=r)}if(n>o){var u=this.content[o],h=this.scoreFunction(u);(null==s?i:l)>h&&(s=o)}if(null==s)break;this.content[t]=this.content[s],this.content[s]=e,t=s}}},n.exports={createKdTree:function(t,n,e){return new i(t,n,e)}}},{}]},{},[1]);